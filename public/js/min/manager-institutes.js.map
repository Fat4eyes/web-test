{"version":3,"sources":["institutes.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"manager-institutes.js","sourcesContent":["$(document).ready(function(){\n    var institutesViewModel = function(){\n        return new function(){\n            var self = this;\n            initializeViewModel.call(self, {\n                page: menu.admin.main\n            });\n\n            self.initial = {\n                institutes: ko.observableArray([]),\n                institute: {\n                    id: ko.observable(0),\n                    name: ko.observable(''),\n                    description: ko.observable('')\n                }\n            };\n            self.current = {\n                institute: ko.observable(self.initial.institute),\n                profiles: ko.observableArray([]),\n                profileId: ko.observable(null),\n                plans: ko.observableArray([]),\n                plan: {\n                    name: ko.observable(''),\n                    mode: ko.observable(state.none)\n                }\n            };\n            self.actions = {\n                show: {\n                    institute: function(data){\n                        var isCurrent =  data.id() === self.current.institute().id();\n                        if (isCurrent) {\n                            self.current.institute(self.initial.institute);\n                            return;\n                        }\n                        self.current.institute.copy(data);\n                        self.get.profiles();\n                    },\n                    plans: function(data){\n                        self.current.profileId(data.id());\n                        self.get.plans();\n                        commonHelper.modal.open('#show-plans-modal');\n                    }\n                },\n                moveTo: {\n                    group: function(data){\n                        var url = '/admin/groups/' + data.id();\n                        window.location.href = url;\n                    },\n                    plan: function(data){\n                        window.location.href = '/admin/studyplan/' + data.id();\n                    }\n                },\n                plan: {\n                    create: function(){\n                        self.actions.plan.cancel();\n                        self.current.plan.mode(state.create);\n                    },\n                    cancel: function(){\n                        self.current.plan.name('');\n                        self.current.plan.mode(state.none);\n                    },\n                    approve: function(){\n                        if (!self.current.plan.name()) return;\n                        self.post.plan();\n                    }\n                }\n            };\n            self.get = {\n                institutes: function(){\n                    var requestOptions = {\n                        url: '/api/institutes',\n                        errors: self.errors,\n                        successCallback: function(data){\n                            self.initial.institutes(data());\n                        }\n                    };\n                    $ajaxget(requestOptions);\n                },\n                profiles: function(){\n                    var requestOptions = {\n                        url: '/api/institute/'+ self.current.institute().id() + '/profiles',\n                        errors: self.errors,\n                        successCallback: function(data){\n                            self.current.profiles(data());\n                        }\n                    };\n                    $ajaxget(requestOptions);\n                },\n                plans: function(){\n                    var requestOptions = {\n                        url: '/api/profile/'+ self.current.profileId() + '/plans',\n                        errors: self.errors,\n                        successCallback: function(data){\n                            self.current.plans(data());\n                        }\n                    };\n                    $ajaxget(requestOptions);\n                }\n            };\n            self.post = {\n                plan: function(){\n                    var requestOptions = {\n                        url: '/api/plan/create',\n                        errors: self.errors,\n                        data: JSON.stringify({\n                            studyPlan: {name: self.current.plan.name()},\n                            profileId: self.current.profileId()\n                        }),\n                        successCallback: function(){\n                            self.actions.plan.cancel();\n                            self.get.plans()\n                        }\n                    };\n                    $ajaxpost(requestOptions);\n                }\n            };\n\n            self.get.institutes();\n\n            self.events.plan = function(data, e){\n                if (e.which === 13)\n                    self.actions.plan.approve();\n            };\n\n            return returnStandart.call(self);\n        };\n    };\n    ko.applyBindings(institutesViewModel());\n});"],"sourceRoot":"/source/"}